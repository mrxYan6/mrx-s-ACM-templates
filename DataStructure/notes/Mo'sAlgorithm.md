# 莫队

## 普通莫队

能够快速维护插入一个元素和删除一个元素时，可以使用莫队算法。

莫队算法的思想是将询问分块，每次处理一个块，块内的询问按照右端点排序，块外的询问按照左端点排序，这样可以保证总时间复杂度是 $O(n \sqrt{m})$ 。

## 回滚莫队

回滚莫队是当插入和删除的复杂性不对等的时候使用的，核心思想在于其对于每个左端点在同一个块内的询问，右边的右端点是递增的，这样右端点最多扫$n$次，总复杂度是 $O(n ^2 / B)$ 。左端点最多扫 $B$ 次，总复杂度是 $O(m \cdot B)$ 。回滚操作使得每次撤销左端点的操作的复杂度是 $O(B)$ ，总复杂度是 $O(m \cdot B)$ 。

这样块长取$n/\sqrt{m}$ ，总复杂度是 $O(n \sqrt{m})$ 。

只插入的回滚莫队:

**[歴史の研究](https://www.luogu.com.cn/problem/AT_joisc2014_c)**

题意要维护区间的最大值，使用只插入的回滚莫队

**[hdu 23 多校第7场 F. Product of Sorting Powers](https://acm.hdu.edu.cn/showproblem.php?pid=7352)**

要维护一个区间的链表，这个链表插入非常困难，删除很简单，所以使用只删除的回滚莫队

